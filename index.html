<!DOCTYPE html>
<html>
  <head>
    <title>AFrameTest</title>
    <script type="text/javascript" src='node_modules/aframe/dist/aframe.js'></script>
  </head>
  <body>
    <script src='spawner.js'></script>
    <script src="https://rawgit.com/ngokevin/aframe-layout-component/master/dist/aframe-layout-component.min.js"></script>
    <script src="https://rawgit.com/ngokevin/aframe-template-component/master/dist/aframe-template-component.min.js"></script>
    <a-scene>

      <a-assets>
        <img id='factoryTexture' src="factory.png">
        <img id='cloudTexture' src="cloudBackground.png">
        <img id="enemy-sprite" crossorigin="" src="https://ucarecdn.com/f11bb3e6-ceb4-427c-bcaa-351cabac37d5/">
        <script id="enemies" type="text/x-nunjucks-template">
          <a-entity layout="type: circle; radius: 5" position="0 0.5 0">
            <!-- Use A-Frame's declarative animation system to have enemies march around us. -->
            <a-animation attribute="rotation" dur="30000" easing="linear" repeat="indefinite" to="0 360 0"></a-animation>

            {% for x in range(num) %}
            <a-image class='enemy' height='1.8' look-at="#player" src="#enemy-sprite" transparent="true">
              <a-animation attribute="opacity" begin="collider-hit" dur="400" ease="linear"
                from="1" to="0"></a-animation>
              <a-animation attribute="scale" begin="collider-hit" dur="400" ease="linear"
                to="0 0 0"></a-animation>
            </a-image>
            {% endfor %}
          </a-entity>
        </script>
        <a-mixin id="laser"
          geometry="primitive: cylinder; radius: 0.05; translate: 0 -2 0"
          material="color: green; metalness: 0.2; opacity: 0.4; roughness: 0.3"
          rotation="90 0 0"
          projectile="speed: -0.5"
          collider='target: .enemy'>
        </a-mixin>
      </a-assets>
      
      <a-entity template="src: #enemies" data-num="10"></a-entity>

      <a-box color="#FFF" width="10" height="10" depth="10" 
        position='-10 5 -15' rotation='0 45 0'
        src='#factoryTexture'>
        <a-animation attribute='rotation' begin='click' from='0 45 0' to='0 135 0' /> 
      </a-box>

      <!-- <a-light type="spot" color="#FFF" position="10 0 30" look-at="a-box"></a-light> -->

      <a-sky src="#cloudTexture"></a-sky>
      <a-plane position='0 0 0' rotation='-90 0 0' height='20' width='20' color='#555'></a-plane>

      <a-camera id="player" position="0 1.8 0" spawner="mixin: laser; on: click" click-listener>
        <!-- <a-cursor color="#2E3A87"></a-cursor> -->
      </a-camera>

    </a-scene>
  </body>
</html>
